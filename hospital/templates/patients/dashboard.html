{% extends 'hospital/base.html' %}
{% block title %}Patient Dashboard - MedVita{% endblock %}
{% block content %}
<div style="background:linear-gradient(135deg,var(--navy),#1a4a8a);padding:40px 0;color:#fff;">
  <div class="container"><h2 style="color:#fff;font-size:1.8rem;">Welcome back, {{ patient.user.first_name }}! &#128075;</h2><p style="color:rgba(255,255,255,.75);">Here is an overview of your health activities</p></div>
</div>
<section class="section-sm">
  <div class="container">
    <div class="dashboard-grid">
      <aside class="sidebar">
        <div style="padding:20px 24px;border-bottom:1px solid var(--gray-100);margin-bottom:8px;">
          <div style="width:56px;height:56px;border-radius:50%;background:linear-gradient(135deg,var(--teal),var(--navy));display:flex;align-items:center;justify-content:center;font-size:1.5rem;color:#fff;margin-bottom:10px;">&#128100;</div>
          <div style="font-weight:600;color:var(--navy);font-size:15px;">{{ patient.full_name }}</div>
          <div style="font-size:12px;color:var(--gray-500);">Patient ID: #{{ patient.id }}</div>
        </div>
        <ul class="sidebar-nav">
          <li><a href="/patients/dashboard/" class="active">&#127968; Dashboard</a></li>
          <li><a href="/patients/profile/">&#128100; My Profile</a></li>
          <li><a href="/appointments/my/">&#128197; My Appointments</a></li>
          <li><a href="/reports/">&#128203; Medical Reports</a></li>
          <li><a href="/appointments/book/">&#10133; Book Appointment</a></li>
          <li><a href="/doctors/">&#128104;&#8205;&#9877; Find Doctors</a></li>
          <li><a href="/patients/logout/" style="color:var(--danger);">&#128682; Logout</a></li>
        </ul>
      </aside>
      <main>
        <div class="grid-4" style="margin-bottom:32px;">
          <div class="stat-card"><div class="icon">&#128197;</div><div class="number">{{ total_appointments }}</div><div class="label">Total Appointments</div></div>
          <div class="stat-card"><div class="icon">&#9203;</div><div class="number">{{ pending_appointments }}</div><div class="label">Pending</div></div>
          <div class="stat-card"><div class="icon">&#128203;</div><div class="number">{{ total_reports }}</div><div class="label">Medical Reports</div></div>
          <div class="stat-card"><div class="icon">&#10084;</div><div class="number">{{ patient.blood_group|default:"--" }}</div><div class="label">Blood Group</div></div>
        </div>
        <div class="card" style="padding:28px;margin-bottom:28px;">
          <h3 style="color:var(--navy);margin-bottom:18px;">Quick Actions</h3>
          <div style="display:flex;gap:12px;flex-wrap:wrap;">
            <a href="/appointments/book/" class="btn btn-primary btn-sm">&#128197; Book Appointment</a>
            <a href="/doctors/" class="btn btn-outline btn-sm">&#128269; Find Doctor</a>
            <a href="/reports/" class="btn btn-navy btn-sm">&#128229; View Reports</a>
            <a href="/patients/profile/" class="btn btn-outline btn-sm">&#9999; Edit Profile</a>
          </div>
        </div>
        <div class="card" style="margin-bottom:28px;">
          <div style="padding:24px;border-bottom:1px solid var(--gray-100);display:flex;justify-content:space-between;align-items:center;">
            <h3 style="color:var(--navy);">Recent Appointments</h3>
            <a href="/appointments/my/" class="btn btn-outline btn-sm">View All</a>
          </div>
          {% if appointments %}
          <div style="overflow-x:auto;">
            <table>
              <thead><tr><th>Doctor</th><th>Date</th><th>Time</th><th>Type</th><th>Status</th><th>Action</th></tr></thead>
              <tbody>
                {% for appt in appointments %}
                <tr>
                  <td><strong>{{ appt.doctor.full_name }}</strong><br><span style="font-size:12px;color:var(--gray-500);">{{ appt.doctor.specialization }}</span></td>
                  <td>{{ appt.appointment_date }}</td>
                  <td>{{ appt.appointment_time }}</td>
                  <td><span class="badge badge-teal">{{ appt.get_appointment_type_display }}</span></td>
                  <td><strong class="status-{{ appt.status }}">{{ appt.get_status_display }}</strong></td>
                  <td>{% if appt.status == "pending" or appt.status == "confirmed" %}<a href="/appointments/{{ appt.id }}/cancel/" class="btn btn-danger btn-sm" onclick="return confirm('Cancel this appointment?')">Cancel</a>{% endif %}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          {% else %}
          <div style="padding:40px;text-align:center;"><div style="font-size:3rem;margin-bottom:12px;">&#128197;</div><p style="color:var(--gray-500);">No appointments yet.</p><a href="/appointments/book/" class="btn btn-primary btn-sm" style="margin-top:12px;">Book Your First Appointment</a></div>
          {% endif %}
        </div>
        <div class="card">
          <div style="padding:24px;border-bottom:1px solid var(--gray-100);display:flex;justify-content:space-between;align-items:center;">
            <h3 style="color:var(--navy);">Recent Medical Reports</h3>
            <a href="/reports/" class="btn btn-outline btn-sm">View All</a>
          </div>
          {% if reports %}
          <div style="overflow-x:auto;">
            <table>
              <thead><tr><th>Report</th><th>Type</th><th>Date</th><th>Doctor</th><th>Action</th></tr></thead>
              <tbody>
                {% for report in reports %}
                <tr>
                  <td><strong>{{ report.title }}</strong></td>
                  <td><span class="badge badge-navy">{{ report.get_report_type_display }}</span></td>
                  <td>{{ report.report_date }}</td>
                  <td>{{ report.doctor.full_name|default:"--" }}</td>
                  <td><a href="/reports/{{ report.id }}/download/" class="btn btn-outline btn-sm">&#128229; Download</a></td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          {% else %}
          <div style="padding:40px;text-align:center;"><div style="font-size:3rem;margin-bottom:12px;">&#128203;</div><p style="color:var(--gray-500);">No medical reports yet.</p></div>
          {% endif %}
        </div>
      </main>
    </div>
  </div>
</section>
{% endblock %}
